<!DOCTYPE html>
<html>
  <head>
    <title>Faculty Dashboard</title>
    <style>
/* Body and container */
body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background: #f8f9fb;
  margin: 40px auto 80px auto;
  max-width: 960px;
  color: #334155;
  line-height: 1.6;
  padding: 0 24px 80px 24px;
}

/* Headings */
h1, h2, h3 {
  font-weight: 700;
  color: #1e293b;
  margin-bottom: 24px;
}

h1 {
  text-align: center;
  font-size: 2.8rem;
  letter-spacing: 0.05em;
  border-bottom: 3px solid #3b82f6;
  padding-bottom: 18px;
  margin-bottom: 48px;
}

h2.section-header {
  margin-top: 60px;
  border-bottom: 2.5px solid #93c5fd;
  padding-bottom: 10px;
  font-size: 2rem;
}

h3 {
  margin-top: 52px;
  font-size: 1.5rem;
  color: #475569;
}

/* Flash messages */
.flash-msg {
  background-color: #dcfce7;
  border: 1.5px solid #22c55e;
  padding: 18px 28px;
  margin-bottom: 32px;
  color: #15803d;
  font-weight: 600;
  border-radius: 12px;
  box-shadow: 0 2px 10px rgba(34, 197, 94, 0.2);
  font-size: 1.1rem;
}

/* Forms */
form {
  margin-bottom: 40px;
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  gap: 20px 28px;
  justify-content: flex-start;
  padding: 14px 20px;
  background: #fff;
  border-radius: 8px;
  box-shadow: 0 2px 6px rgb(100 116 139 / 0.1);
  border: 1px solid #e2e8f0;
}

label {
  flex: 1 1 220px;
  font-weight: 600;
  color: #2563eb;
  font-size: 1.1rem;
  margin-bottom: 6px;
}

select {
  flex: 1 1 240px;
  padding: 10px 16px;
  font-size: 1.1rem;
  border: 1.8px solid #93c5fd;
  border-radius: 8px;
  background: #f9fafb;
  cursor: pointer;
  transition: border-color 0.3s ease, box-shadow 0.3s ease;
  box-shadow: none;
  color: #1e40af;
}

select:focus, select:hover {
  border-color: #2563eb;
  box-shadow: 0 0 8px rgb(59 130 246 / 0.35);
  outline: none;
}

/* Buttons */
button[type="submit"] {
  flex: 0 0 auto;
  padding: 12px 36px;
  background-color: #2563eb;
  color: white;
  font-weight: 700;
  font-size: 1.15rem;
  border: none;
  border-radius: 10px;
  cursor: pointer;
  letter-spacing: 0.06em;
  box-shadow: 0 3px 10px rgb(37 99 235 / 0.35);
  transition: background-color 0.3s ease, transform 0.15s ease;
  user-select: none;
}

button[type="submit"]:hover {
  background-color: #1e40af;
  transform: scale(1.05);
  box-shadow: 0 6px 18px rgb(30 64 175 / 0.55);
}

/* Tables */
table {
  border-collapse: separate;
  border-spacing: 0 14px;
  width: 100%;
  margin-top: 28px;
  font-size: 1.05rem;
  color: #334155;
  background: #fff;
  border-radius: 12px;
  box-shadow: 0 5px 16px rgb(100 116 139 / 0.1);
  overflow: hidden;
}

thead tr th {
  background: #2563eb;
  color: #fff;
  font-weight: 700;
  padding: 16px 24px;
  text-align: left;
  letter-spacing: 0.05em;
  user-select: none;
}

tbody tr {
  background: #f9fafb;
  transition: background-color 0.25s ease;
  border-radius: 10px;
  box-shadow: inset 0 -4px 12px rgb(147 197 253 / 0.2);
}

tbody tr:hover {
  background: #e0e7ff;
}

tbody tr td {
  padding: 14px 24px;
  border-bottom: 1.5px solid #e2e8f0;
  vertical-align: middle;
  letter-spacing: 0.02em;
}

/* Links in table */
a {
  color: #2563eb;
  text-decoration: none;
  font-weight: 600;
  transition: color 0.3s ease;
}

a:hover {
  color: #1e40af;
  text-decoration: underline;
}

/* Inline forms */
form[style*="display:inline"] {
  display: inline;
}

form[style*="display:inline"] button {
  background: #ef4444;
  padding: 8px 20px;
  font-size: 1rem;
  border-radius: 10px;
  box-shadow: none;
  letter-spacing: 0.05em;
  transition: background 0.3s ease;
  font-weight: 700;
  cursor: pointer;
  color: white;
}

form[style*="display:inline"] button:hover {
  background: #b91c1c;
}

/* Paragraph messages */
p {
  margin-top: 20px;
  line-height: 1.5;
  font-size: 1.05rem;
  color: #475569;
}

/* Responsive */
@media (max-width: 600px) {
  body {
    margin: 24px 12px 80px 12px;
  }
  table, thead tr th, tbody tr td {
    font-size: 1rem;
  }
  label, select, button {
    width: 100%;
    flex: none;
    margin-bottom: 14px;
  }
  form {
    flex-direction: column;
    align-items: stretch;
    padding: 16px 18px;
  }
  button[type="submit"] {
    padding: 14px 0;
  }
}
</style>

  </head>
  <body>
    <h1>Welcome Faculty</h1>

    <!-- Flash messages for deletes/success -->
    {% with messages = get_flashed_messages() %}
      {% if messages %}
        <div class="flash-msg">
          {% for message in messages %}
            {{ message }}
          {% endfor %}
        </div>
      {% endif %}
    {% endwith %}

    <!-- Start/Stop session form -->
    <form method="POST" action="{{ url_for('faculty.start_stop_session') }}" style="margin-bottom:24px">
      <label for="subject-select">Select Subject to Start/Stop Session:</label>
      <select name="subject_id" id="subject-select" required>
        {% for subject in subjects %}
        <option value="{{ subject.id }}">{{ subject.name }}</option>
        {% endfor %}
      </select>
      <button type="submit" name="action" value="start">Start Session</button>
      <button type="submit" name="action" value="stop">Stop Session</button>
    </form>

    <!-- Show active session info -->
    {% if session.get('attendance_session_id') %}
      <h2>Attendance Session Active</h2>
      <p>
        Session started. Open attendance page to mark attendance:
        <a href="{{ url_for('attendance.attendance') }}" target="_blank">Attendance Page</a>
      </p>
    {% else %}
      <p>No active attendance session.</p>
    {% endif %}

    <hr />

    <!-- Subject selection form for attendance display -->
    <form method="GET" action="{{ url_for('faculty.faculty_dashboard') }}" style="margin-bottom:24px">
      <label for="subject-view">Select Subject to View Attendance:</label>
      <select name="subject_id" id="subject-view" onchange="this.form.submit()">
        <option value="">--Select a Subject--</option>
        {% for subject in subjects %}
        <option value="{{ subject.id }}" {% if subject.id == selected_subject %}selected{% endif %}>
          {{ subject.name }}
        </option>
        {% endfor %}
      </select>
    </form>

    {% if selected_subject %}
      <h2 class="section-header">
        Attendance Sessions for 
        {% set selected = subjects | selectattr("id", "equalto", selected_subject) | list | first %}
        {{ selected.name if selected else 'Selected Subject' }}
      </h2>

      {% if sessions %}
        <table>
          <thead>
            <tr>
              <th>Session Date</th>
              <th>Export</th>
              <th>Delete Records</th>
            </tr>
          </thead>
          <tbody>
            {% for session in sessions %}
            <tr>
              <td>{{ session.start_time.strftime("%Y-%m-%d %H:%M") }}</td>
              <td>
                <a href="{{ url_for('faculty.export_attendance', subject_id=selected_subject) }}" target="_blank">Export Excel</a>
              </td>
              <td>
                <form method="POST" action="{{ url_for('faculty.delete_attendance', session_id=session.id) }}"
                      onsubmit="return confirm('Are you sure you want to delete attendance records and this session?');" style="display:inline;">
                  {# If using Flask-WTF, add: {{ csrf_token() }} #}
                  <button type="submit">Delete Records</button>
                </form>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>

        <h3>Overall Attendance Summary</h3>
        <table>
          <thead>
            <tr>
              <th>USN</th>
              <th>Name</th>
              <th>Present</th>
              <th>Absent</th>
            </tr>
          </thead>
          <tbody>
            {% for student, summary in attendance_summary.items() %}
            <tr>
              <td>{{ student.usn }}</td>
              <td>{{ student.name }}</td>
              <td>{{ summary.present }}</td>
              <td>{{ summary.absent }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      {% else %}
        <p>No attendance sessions found for this subject.</p>
      {% endif %}
    {% endif %}
  </body>
</html>
